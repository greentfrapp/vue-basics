<template>
  <div id="app">
    <h1 style="text-align: center;">Scroll Demo</h1>
    <hr/>
    <div id="section-1">
      <h2>First Section</h2>
      <p>
        In irure pariatur velit in commodo mollit nisi aliquip pariatur est amet ad ad occaecat adipisicing ut amet aliqua nulla sint dolor consectetur cupidatat ex ullamco et.
      </p>
      <p>
        Adipisicing irure laboris id culpa ex veniam proident esse minim qui cillum deserunt laboris ut elit ut laborum ut commodo cupidatat officia fugiat consequat elit eu culpa amet duis deserunt duis dolore amet.
      </p>
    </div>
    <div id="chopstick-divider">
      <img src="./chopstick_solid.png" id="stick1" class="chopsticks">
      <img src="./chopstick_solid.png" id="stick2" class="chopsticks">
    </div>
    <div id="section-2">
      <div id="title">
        <h2>Second Section</h2>
      </div>
      <div id="text">
        <div class="step" data-step="subsection-a">
          <h2>Subsection A</h2>
          <p>
            Exercitation occaecat incididunt in fugiat laborum anim fugiat et laborum do anim irure consequat esse pariatur duis dolore est ea labore consequat officia consectetur sed irure ad dolore commodo amet in cupidatat aliquip sunt dolore nisi ut dolor eiusmod veniam anim elit dolore laborum eu proident cillum esse dolore enim veniam eu reprehenderit ea dolore occaecat in duis occaecat incididunt non deserunt proident eu non adipisicing incididunt veniam sunt culpa in dolore sunt sint aliqua qui incididunt in commodo in qui velit incididunt et sunt cillum proident ut in ad esse labore exercitation sed ex cupidatat sunt occaecat ut dolore qui deserunt aliqua velit dolor consequat deserunt fugiat aute quis commodo ut officia in sint irure exercitation dolor enim eiusmod nisi laborum ea fugiat aute ex dolore aliqua dolor irure cupidatat elit dolor ex quis consequat elit quis dolore do officia ex aute veniam sint.
          </p>
        </div>
        <div class="step" data-step="subsection-b">
          <h2>Subsection B</h2>
          <p>
            Dolor ad minim irure deserunt adipisicing laboris non officia est esse qui excepteur voluptate ex deserunt consectetur culpa culpa deserunt exercitation officia ut ex ea ex minim. Nulla eu sed qui labore pariatur tempor laboris amet deserunt fugiat sed eiusmod in dolore eu quis eu deserunt mollit pariatur aliqua reprehenderit ut.
          </p>
        </div>
        <div class="step" data-step="subsection-c">
          <h2>Subsection C</h2>
          <p>
            In nisi do eiusmod consectetur occaecat culpa fugiat mollit fugiat enim enim voluptate dolor tempor cupidatat mollit sed incididunt occaecat mollit reprehenderit esse elit esse et ea voluptate eu dolor enim in sit laboris fugiat aliqua culpa pariatur dolore dolor incididunt ut eiusmod tempor ea cupidatat consectetur occaecat commodo non eiusmod elit mollit enim magna in in dolor veniam ea fugiat sunt in sint id sint consectetur commodo voluptate officia sit fugiat nulla cupidatat culpa velit nostrud incididunt nostrud laborum id duis elit qui dolor qui sint tempor ullamco consequat sunt nostrud officia deserunt sint ut excepteur nostrud ullamco esse sunt exercitation ex ad minim aliqua magna magna aliquip aliqua amet in exercitation non nisi quis pariatur amet voluptate quis nisi laborum non qui officia excepteur fugiat tempor occaecat nulla nisi id velit sed mollit excepteur voluptate commodo sed amet ut pariatur ad occaecat incididunt laborum amet ad in amet.
          </p>
        </div>
      </div>
      <svg>
      </svg>
    </div>
    <div class="large parallax">
    </div>
    <div id="section-3">
      <h2>Third Section</h2>
      <p>
        In irure pariatur velit in commodo mollit nisi aliquip pariatur est amet ad ad occaecat adipisicing ut amet aliqua nulla sint dolor consectetur cupidatat ex ullamco et.
      </p>
      <p>
        Lorem ipsum duis elit labore aute non ut incididunt aliquip reprehenderit nostrud esse tempor excepteur eu officia mollit eu duis dolore excepteur aute officia cillum non id officia deserunt velit consectetur cupidatat proident dolor laboris esse ea aliqua eu ea sit elit ut ad incididunt elit veniam consectetur nulla ut dolore ut sunt commodo amet adipisicing dolor ea ut ex ex occaecat dolor consequat aute aliquip mollit in dolore esse ut enim dolor sed dolore elit in veniam mollit velit reprehenderit nulla nulla laboris dolore aliqua sunt ut officia ea cillum aute elit dolore cupidatat est ut nostrud ullamco anim et dolor occaecat minim incididunt sed pariatur ut deserunt veniam dolore laboris excepteur ut in amet consectetur pariatur ea ullamco tempor nulla cupidatat adipisicing magna velit anim quis laboris deserunt cupidatat ea non non dolore velit anim aliquip nostrud proident in magna officia ad amet qui occaecat ad consectetur id sunt dolore est sit nisi sint ea culpa labore nostrud reprehenderit magna dolore consectetur ut id sint qui labore dolore laborum cillum adipisicing aliquip sit eiusmod voluptate qui aliqua fugiat exercitation quis elit aliquip irure magna amet voluptate est cupidatat officia dolore exercitation do officia ullamco velit enim ea consequat minim in irure sit in dolor ut cillum laboris et commodo occaecat id exercitation dolor ut ex commodo aliquip anim dolor adipisicing velit et laborum amet non officia et aliqua ea voluptate quis nisi aliqua quis non irure ea officia mollit labore nisi aute excepteur velit ut culpa nulla proident minim tempor enim aliquip dolor eu et adipisicing.
      </p>
    </div>
    <div class="large2 parallax">
    </div>
    <div id="section-4">
      <div id="title">
        <h2>Fourth Section</h2>
      </div>
      <div id="text">
        <div class="step" data-step="subsection-a">
          <h2>Subsection A</h2>
          <p>
            Exercitation occaecat incididunt in fugiat laborum anim fugiat et laborum do anim irure consequat esse pariatur duis dolore est ea labore consequat officia consectetur sed irure ad dolore commodo amet in cupidatat aliquip sunt dolore nisi ut dolor eiusmod veniam anim elit dolore laborum eu proident cillum esse dolore enim veniam eu reprehenderit ea dolore occaecat in duis occaecat incididunt non deserunt proident eu non adipisicing incididunt veniam sunt culpa in dolore sunt sint aliqua qui incididunt in commodo in qui velit incididunt et sunt cillum proident ut in ad esse labore exercitation sed ex cupidatat sunt occaecat ut dolore qui deserunt aliqua velit dolor consequat deserunt fugiat aute quis commodo ut officia in sint irure exercitation dolor enim eiusmod nisi laborum ea fugiat aute ex dolore aliqua dolor irure cupidatat elit dolor ex quis consequat elit quis dolore do officia ex aute veniam sint.
          </p>
        </div>
        <div class="step" data-step="subsection-b">
          <h2>Subsection B</h2>
          <p>
            Dolor ad minim irure deserunt adipisicing laboris non officia est esse qui excepteur voluptate ex deserunt consectetur culpa culpa deserunt exercitation officia ut ex ea ex minim. Nulla eu sed qui labore pariatur tempor laboris amet deserunt fugiat sed eiusmod in dolore eu quis eu deserunt mollit pariatur aliqua reprehenderit ut.
          </p>
        </div>
      </div>
      <svg>
      </svg>
    </div>
    <div id="section-5">
      <h2>Fifth Section</h2>
      <p>
        Irure minim aliquip excepteur id est officia ut amet quis ad occaecat dolore cillum sunt et consequat nisi nisi dolor irure aliqua id in ullamco incididunt. Laboris pariatur sed in dolor nostrud dolore aliquip tempor eu dolore cupidatat laborum in do ut cupidatat eu commodo labore dolore nulla. Lorem ipsum pariatur in in nisi in nisi adipisicing sint laboris ea ut occaecat laborum qui laboris ut ut dolor id laboris magna labore dolor ex ut ullamco dolor enim ad fugiat in cillum in nulla dolore. Consequat quis ut sit in aliqua dolore ut aute cillum aute consectetur non fugiat eiusmod sed id adipisicing irure dolore est id sed dolor incididunt mollit non laborum in duis pariatur sunt.
      </p>
      <p>
        Anim ad amet officia aute sit consectetur ullamco cupidatat irure reprehenderit aliqua commodo minim tempor in occaecat laborum excepteur.
      </p>
    </div>
  </div>
</template>

<script>
import * as d3 from 'd3'
const scrollama = require('scrollama');

export default {
  name: 'app',
  components: {
  },
  mounted() {
    this.setupSvgs();

    // Section 2 Scroller
    const scrollerSection2 = scrollama();
    scrollerSection2
      .setup({
        step: '#section-2 .step',
        offset: 0.5, // when the element is 0.5 shown/hidden, the enter/exit step triggers
      })
      .onStepEnter((response) => {
        // response has properties { element, index, direction }
        // Increase opacity of entering element
        d3.select(response.element)
          .transition().duration(200)
          .style('opacity', 1)
        // Move images downwards
        d3.selectAll(`#section-2 image.${d3.select(response.element).attr('data-step')}`)
            .transition().duration(500)
            .delay((d, i) => 150 + 150 * i)
            .attr('y', (d, i) => 400 - i * 60)
            .attr('opacity', 1)
        d3.select(`#section-2 text.${d3.select(response.element).attr('data-step')}`)
          .transition().duration(500)
          .attr('y', 520)
      })
      .onStepExit(response => {
        // response has properties { element, index, direction }
        // Reduce opacity of exiting element
        d3.select(response.element)
          .transition().duration(200)
          .style('opacity', 0.5)
        // If scrolling back up, we want to undo the graphics
        // ie. move images back up
        if (response.direction === 'up') {
          d3.selectAll(`image.${d3.select(response.element).attr('data-step')}`)
            .transition().duration(500)
            .attr('y', -100)
            .attr('opacity', 0)
          d3.select(`#section-2 text.${d3.select(response.element).attr('data-step')}`)
          .transition().duration(500)
          .attr('y', -100)
        }
      });

    // Section 4 Scroller
    const scrollerSection4 = scrollama();
    scrollerSection4
      .setup({
        step: '#section-4 .step',
        offset: 0.5,
        // Set progress: true
        progress: true,
      })
      .onStepEnter((response) => {
        // response has properties { element, index, direction }
        // Increase opacity of entering element
        d3.select(response.element)
          .transition().duration(200)
          .style('opacity', 1)
      })
      .onStepExit(response => {
        // response has properties { element, index, direction }
        // Reduce opacity of exiting element
        d3.select(response.element)
          .transition().duration(200)
          .style('opacity', 0.5)
      })
      .onStepProgress(response => {
        // response has properties { element, index, direction, progress }
        if (response.index === 0) {
          // Change x-coordinate of bowl by the scroll progress
          let startX = 400,
          endX = -300,
          scale = d3.scaleLinear().domain([0, 1]).range([startX, endX])
          d3.select('#section-4 image.bowl')
            .transition()
            .duration(0)
            .attr('x', scale(response.progress))
        } else if (response.index === 1) {
          // Change opacity of bowl by the scroll progress
          let startOpacity = 1,
          endOpacity = 0,
          scale = d3.scaleLinear().domain([0, 1]).range([startOpacity, endOpacity])
          d3.select('#section-4 image.bowl')
            .transition()
            .duration(0)
            .attr('opacity', scale(response.progress))
        }
      });

    // setup resize event
    window.addEventListener('resize', scrollerSection2.resize);
    window.addEventListener('resize', scrollerSection4.resize);
  },
  data() {
    return {}
  },
  methods: {
    setupSvgs() {
      // Create all the SVG elements
      // The scroller should not be creating or
      // destroying anything during the enter/exit steps

      // Section 2 Setup
      let sections = ['subsection-a', 'subsection-b', 'subsection-c'],
      values = {
        "subsection-a": new Array(1),
        "subsection-b": new Array(2),
        "subsection-c": new Array(3),
      },
      labels = {
        "subsection-a": "Singapore",
        "subsection-b": "Malaysia",
        "subsection-c": "Japan",
      }
      // Add images corresponding to sections and values
      sections.forEach((sec, i) => {
        d3.select('#section-2 svg')
          .selectAll(`image.${sec}`)
          .data(values[sec]).enter()
          .append('image')
          .attr('class', sec)
          .attr('xlink:xlink:href', "./bowl.png")
          .attr('width', 100)
          .attr('height', 100)
          .attr('x', 100 + i * 100)
          .attr('y', -100)
          .attr('opacity', 0)
        d3.select('#section-2 svg')
          .append('text')
          .attr('class', sec)
          .attr('text-anchor', 'middle')
          .text(labels[sec])
          .attr('x', 145 + i * 100)
          .attr('y', -100)
      })

      // Section 4 Setup
      d3.select('#section-4 svg')
        .append('image')
        .attr('class', 'bowl')
        .attr('xlink:xlink:href', "./meme.jpg")
        .attr('width', 600)
        .attr('height', 600)
        .attr('x', 400)
        .attr('y', 0)
        .attr('opacity', 1)
    }
  }
}
</script>

<style scoped>

h2 {
  text-transform: uppercase;
}

.step {
  padding: 20px;
  margin: 10px 0;
  opacity: 0.5;
}

#section-2 .step {
  background-color: #ffddb6;
}

#section-4 .step {
  background-color: #d3fff8;
}

#app {
  width: 90%;
}

#title {
  position: sticky;
  top: 100px;
  vertical-align: top;
  display: inline-block;
  width: 15%;
}

#text {
  display: inline-block;
  width: 40%;
}

svg {
  position: sticky;
  top: 0;
  display: inline-block;
  vertical-align: top;
  width: 40%;
  height: 100vh;
  border: none;
}

#section-1, #section-2, #section-3 {
  margin: 50px 0;
}

#section-2 {
  margin-top: 0;
}

#section-3, #section-4 {
  margin-top: calc(100px + 20vh);
}

.parallax {
  position: absolute;
  box-sizing: border-box;
  width: 90vw;
  height: 20vh;
  background-attachment: fixed;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  opacity: 0.6;

}

.large {
  background-image: url("./large.jpg");
  left: 10vw;
  border-left: 20px solid #ff8800;
}

.large2 {
  background-image: url("./large2.jpg");
  right: 10vw;
  border-right: 20px solid #ff8800;
}

#chopstick-divider {
  position: relative;
  right: 0vw;
  box-sizing: border-box;
  height: 20vh;
}

.chopsticks {
  position: absolute;
  right: 0vw;
  width: 50vw;
  transform-origin: 85% 50%;
}
#stick2 {
  top: 20px;
  animation: animate-two 1.5s infinite;
}
@keyframes animate-two {
  0%{
    transform: rotate(1.5deg);
  }
  50%{
    transform: rotate(-3deg);
  }
  100%{
    transform: rotate(1.5deg);
  }
}

</style>
